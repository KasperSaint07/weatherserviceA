<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Weather â€” Live WS</title>
    <style>
        body {font-family: system-ui, sans-serif; max-width: 720px; margin: 32px auto;}
        .card {border: 1px solid #ddd; border-radius: 12px; padding: 16px; margin: 12px 0;}
        .row {display: flex; gap: 16px;}
        .k {color:#666;}
        .v {font-weight:700;}
        #status {font-size: 14px; color:#666}
    </style>
</head>
<body>
<h1>ğŸŒ¤ï¸ Weather â€” WebSocket stream</h1>
<div id="status">Connectingâ€¦</div>

<div class="card">
    <div class="row"><span class="k">Temperature:</span> <span id="t" class="v">â€”</span></div>
    <div class="row"><span class="k">Humidity:</span>    <span id="h" class="v">â€”</span></div>
    <div class="row"><span class="k">Pressure:</span>    <span id="p" class="v">â€”</span></div>
</div>

<div class="card"><pre id="raw">{}</pre></div>

<script>
    const t = document.getElementById('t');
    const h = document.getElementById('h');
    const p = document.getElementById('p');
    const raw = document.getElementById('raw');
    const statusEl = document.getElementById('status');

    // Ğ•ÑĞ»Ğ¸ Ñƒ Ñ‚ĞµĞ±Ñ Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ /ws/weather â€” Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ.
    // Ğ•ÑĞ»Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ â€” Ğ²Ğ¿Ğ¸ÑˆĞ¸ ÑĞ²Ğ¾Ğ¹ Ğ¿ÑƒÑ‚ÑŒ.
    const url = (location.protocol === 'https:' ? 'wss://' : 'ws://')
        + location.host + '/ws/weather';

    function connect() {
        const ws = new WebSocket(url);

        ws.onopen = () => { statusEl.textContent = 'Connected âœ”'; };

        ws.onmessage = (e) => {
            try {
                const data = JSON.parse(e.data);
                t.textContent = data.temperature?.toFixed?.(1) ?? data.temperature;
                h.textContent = data.humidity?.toFixed?.(1) ?? data.humidity;
                p.textContent = data.pressure?.toFixed?.(1) ?? data.pressure;
                raw.textContent = JSON.stringify(data, null, 2);
            } catch {
                // ĞĞ° ÑĞ»ÑƒÑ‡Ğ°Ğ¹ ĞµÑĞ»Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€ ÑˆĞ»Ñ‘Ñ‚ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸
                raw.textContent = e.data;
            }
        };

        ws.onclose = () => {
            statusEl.textContent = 'Disconnectedâ€¦ reconnecting in 2s';
            setTimeout(connect, 2000);
        };

        ws.onerror = () => { statusEl.textContent = 'WS error'; };
    }
    connect();
</script>
</body>
</html>
